@startuml workspace_update_sequence
actor User
participant Workspace
participant "Message Queue" as MQ
participant System
participant "Persistence Service" as PersistenceService
database DB
actor "Other User" as OtherUser

== User edits Workspace ==
User -> Workspace: Edit element
Workspace -> MQ: Publish "WorkspaceChanged" event

== <color:red>System processes event (Not Yet Implemented)</color> ==
MQ -> System: Deliver "WorkspaceChanged"
System -> PersistenceService: Apply event (idempotent)
PersistenceService -> DB: Persist new state/version
DB --> PersistenceService: Ack
PersistenceService --> System: Ack applied
System -> MQ: Publish "WorkspaceChanged" (delta)

== Workspace updates ==
MQ -> Workspace: Deliver "WorkspaceChanged"
Workspace --> User: Update view

== <color:red>Update livestream view (Not Yet Implemented)</color> ==
Workspace --> OtherUser: Update view

== <color:red>Late joiner (Not Yet Implemented)</color> ==
OtherUser -> System: Request current state
System -> DB: Fetch latest model
DB --> System: Return current snapshot
System --> OtherUser: Send initial model
note right of OtherUser
After snapshot, continue consuming  
"PersistenceServiceChanged" events from MQ  
to stay in sync.  
end note
@enduml
